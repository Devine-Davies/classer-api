class k{constructor(){this.token=null,this.tab="stats",this.handlers={logs:()=>h("app.log",this.token),stats:()=>g(this.token)}}switchTab(e){var o,n;this.tab=e,(n=(o=this.handlers)[e])==null||n.call(o)}}const u=new k;window.tabUI=()=>u;let d=null;document.addEventListener("DOMContentLoaded",()=>{S(),L()});function S(){grecaptcha.ready(()=>{grecaptcha.execute("6LdNKLMpAAAAAFPilXVAY_0W7QTOEYkV6rgYZ6Yq",{action:"submit"}).then(t=>{document.querySelector("#form form").insertAdjacentHTML("beforeend",`<div class="hidden">
                    <input type="hidden" name="grc" value="${t}">
                </div>`)})})}function L(){document.querySelectorAll(".eye-show-password").forEach(t=>{t.addEventListener("click",()=>{const e=t.previousElementSibling;e.type=e.type==="password"?"text":"password"})})}document.addEventListener("htmx:beforeRequest",()=>{document.querySelector(".error-message").classList.add("hidden"),document.querySelector("input[type=submit]").classList.add("pointer-events-none")});document.addEventListener("htmx:afterRequest",t=>{JSON.parse(t.detail.xhr.response),setTimeout(()=>{if(!t.detail.successful){document.querySelector("input[type=submit]").classList.remove("pointer-events-none");const o=document.querySelector(".error-message");o.innerHTML="Something went wrong, please try again.",o.classList.remove("hidden");return}document.getElementById("form").classList.add("hidden"),document.querySelector("[x-data]").classList.remove("hidden");const e=t.detail.xhr.getResponseHeader("x-token");u.token=e,u.switchTab("stats"),T(e)},500)});function T(t){d&&clearInterval(d),d=setInterval(()=>{g(t),h("app.log",t)},9e5)}function g(t){fetch(pageUrl+"/api/admin/stats",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+t}}).then(e=>{e.json().then(o=>{const n=document.getElementById("stats-template").innerHTML;document.getElementById("stats-container");const c=b(o.data),l=object.entries(c).flatMap(([a,r])=>r.map(i=>y(n,{...i,key:a})));console.log("Stats data:",c),console.log("Rendered HTML items:",l)})})}function h(t,e){fetch(pageUrl+"/api/admin/logs/"+t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e}}).then(o=>{o.json().then(n=>{const c=document.getElementById("logs-template").innerHTML,l=document.getElementById("logs-container"),a=(n??[]).reverse().filter(r=>r.trim()!=="").map(r=>{const i=r.match(/^\[(.*?)\]\s+(\w+)\.(\w+):\s+\[(.*?)\]\s+(.*)$/);if(!i)return"";const[,s,m,_,v,f]=i,p={ERROR:"ðŸ”´",WARNING:"ðŸŸ¡",INFO:"ðŸ”µ",DEBUG:"ðŸŸ¤",default:"ðŸŸ¤"},w=p[_.toUpperCase()]||p.default;return y(c,{timestamp:s,context:v,message:f,icon:w})});l.innerHTML=a.join("")})})}function b(t){const e=s=>s.toLocaleString(),o=s=>(s/1024/1024).toFixed(2)+" MB",n="bg-blue-500",c="bg-green-500",l="bg-yellow-500",a={total_users:{icon:"people",title:"Total Users",color:n,converter:e},total_monthly_registers:{icon:"star",title:"Monthly Registers",color:n,converter:e},total_monthly_logins:{icon:"login",title:"Monthly Logins",color:c,converter:e},total_weekly_registers:{icon:"star",title:"Weekly Registers",color:n,converter:e},total_weekly_logins:{icon:"login",title:"Weekly Logins",color:c,converter:e},cs_active_weekly_total:{icon:"storage",title:"CS - Weekly Active",color:l,converter:e},cs_active_weekly_size:{icon:"storage",title:"CS - Weekly Size Active",color:l,converter:o},cs_deleted_weekly_total:{icon:"storage",title:"CS - Weekly Deleted",color:l,converter:e},cs_deleted_weekly_size:{icon:"storage",title:"CS - Weekly Size Deleted",color:l,converter:o},cs_total:{icon:"cloud",title:"CS - Total Active/Deleted",color:l,converter:e},cs_size:{icon:"cloud",title:"CS - Total Size Active/Deleted",color:l,converter:o}},r={registrationKeys:["total_users","total_monthly_registers","total_weekly_registers"],loginKeys:["total_monthly_logins","total_weekly_logins"],csKeys:["cs_total","cs_size","cs_active_weekly_total","cs_active_weekly_size","cs_deleted_weekly_total","cs_deleted_weekly_size"]},i=Object.entries(t).map(([s,m])=>({...a[s],stat:a[s].converter(m)}));return{auth:i.filter(s=>r.registrationKeys.includes(s.icon)),login:i.filter(s=>r.loginKeys.includes(s.icon)),cloudShares:i.filter(s=>r.csKeys.includes(s.icon))}}function y(t,e){return t.replace(/\${(.*?)}/g,(o,n)=>e[n.trim()])}
